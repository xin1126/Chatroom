import{n as e,i as a,d as o,w as l}from"./role.e7340623.js";import{e as u}from"./vendor.d5f23afa.js";const t=u(""),n=u(""),s=u(""),v=u(""),c=u(""),i=u(""),r=u(!1),p=()=>{const e=setInterval((()=>{c.value=v.value.readyState,c.value&&clearInterval(e)}),500)},b=()=>{const l={},u={};l[e.value]=a.value,u[e.value]={content:"",status:!0},o.ref("chatroom").push().set(u).then((()=>{o.ref("onLine").push().set(l)})).then((()=>{v.value=new WebSocket("wss://fierce-savannah-16080.herokuapp.com/"),p()})),o.ref().on("value",(e=>{t.value=Object.entries(e.val().chatroom),e.val().onLine&&(n.value=Object.entries(e.val().onLine).map((e=>e[1]))||{})}))},m=(u,c)=>{let i;const b={},m={},f={};o.ref("publicRoom").push().set(1),o.ref("publicRoom").once("value",(a=>{s.value=Object.keys(a.val()).pop(),b[e.value]={content:"",status:!0},o.ref("publicRoom").child(s.value).push().set(b),c&&(f[s.value]=l.value,o.ref("privateRoom").push().set(f))})),o.ref("onLinePublicRoom").push().set(1),o.ref("onLinePublicRoom").once("value",(l=>{i=Object.keys(l.val()).pop(),m[e.value]=a.value,o.ref("onLinePublicRoom").child(i).push().set(m).then((()=>{v.value=new WebSocket(u),p()}))})),o.ref().on("value",(e=>{var a;r.value&&e.val().publicRoom[s.value]&&(t.value=Object.entries(e.val().publicRoom[s.value]),(null==(a=e.val().onLinePublicRoom)?void 0:a[i])&&(n.value=Object.entries(e.val().onLinePublicRoom[i]).map((e=>e[1]))))}))},f=()=>{let l,u;const s={},c={},b={};o.ref("publicRoom").once("value",(a=>{s[e.value]={content:"",status:!0},o.ref("publicRoom").child(i.value).push().set(s),l=Object.keys(a.val()).indexOf(i.value)})),o.ref("onLinePublicRoom").once("value",(t=>{u=Object.keys(t.val())[l],c[e.value]=a.value,o.ref("onLinePublicRoom").child(u).push().set(c),b[i.value]=u,o.ref("targetRoom").push().set(b).then((()=>{v.value=new WebSocket("wss://young-coast-22846.herokuapp.com/"),p()}))})),o.ref().on("value",(e=>{var a;r.value&&e.val().publicRoom[i.value]&&(t.value=Object.entries(e.val().publicRoom[i.value]),(null==(a=e.val().onLinePublicRoom)?void 0:a[u])&&(n.value=Object.entries(e.val().onLinePublicRoom[u]).map((e=>e[1]))||{}))}))};export{i as a,c as b,m as c,t as d,f as e,r as f,b as g,n as o,s as r,v as w};
