import{e,j as t,w as a,k as n,q as l,o as s,b as r,g as i,t as o,F as c,l as d,h as u,m as g,n as v,s as x,x as p}from"./vendor.413d03e5.js";import{n as b,i as m,p as y,c as h}from"./role.a999e415.js";const f={setup(){const s=e(""),r=e(""),i=e(""),o=e(""),c=e(""),d=e(""),u=e(""),g=e("請輸入留言"),v=e(!1),x=t(),p=e(JSON.parse(localStorage.getItem(b.value))||[]);let f;return a(s,(()=>{setTimeout((()=>{var e;u.value.scrollTop=(null==(e=u.value)?void 0:e.scrollHeight)+2e3}),450)})),n((()=>{if(b.value){d.value=window.innerHeight;const e={};e[b.value]=m.value,y.ref("onLine").push().set(e),f=new WebSocket("ws://fierce-savannah-16080.herokuapp.com/"),y.ref().on("value",(e=>{s.value=Object.entries(e.val().chatroom),r.value=Object.entries(e.val().onLine).map((e=>e[1]))}))}else x.push("/")})),l((()=>{null==f||f.close()})),{name:b,data:s,onLine:r,str:g,height:d,addData:()=>{if(""!==i.value){const e={};e[b.value]={img:m.value,content:i.value,date:(new Date).getTime(),edit:!1},i.value="",y.ref("chatroom").push().set(e);const t=[...s.value].pop()[0];p.value.push(t),localStorage.setItem(b.value,JSON.stringify(p.value))}else g.value="請輸入留言"===g.value?"尚未輸入留言":"請輸入留言"},message:i,tempId:p,editData:(e,t,a)=>{if(a)o.value=""!==o.value?"":e,c.value=""!==c.value?"":t,v.value=!1;else{if(v.value=!0,t===c.value||""===c.value)return;const a={};a[b.value]={img:m.value,content:c.value,date:(new Date).getTime(),edit:!0},y.ref("chatroom").child(e).set(a),o.value="",c.value=""}},editInput:o,editMessage:c,removeMessage:e=>{const t={};t[b.value]={content:""},y.ref("chatroom").child(e).set(t)},verify:v,checked:h,scroll:u}}},k={class:"flex justify-center"},w={class:"text-center mt-3 text-white dark:text-gray-600"},j={class:"pl-3"},O=i("div",{class:"w-[12px] h-[12px] bg-green-500 rounded-full ml-auto mr-3"},null,-1),D={class:"\n        flex\n        justify-center\n        items-center\n        flex-col\n        bg-gray-500\n        dark:bg-gray-200\n        p-3\n      "},I={class:"\n            md:hidden\n            onLine\n            flex\n            justify-between\n            bg-gray-800\n            dark:bg-gray-300\n            px-3\n            py-2\n          "},L={class:"text-white dark:text-gray-600"},M={class:"message"},C={key:0,class:"flex break-all mb-8"},S={class:"ml-1"},T={class:"text-white dark:text-gray-500 mb-1 relative"},H={class:"absolute w-52 bottom-1 ml-2 text-gray-400 text-xs"},J={class:"\n                    relative\n                    bg-gray-500\n                    text-white text-lg\n                    px-3\n                    py-1\n                    ml-2\n                    rounded-lg\n                  "},N=i("i",{class:"fas fa-2x fa-caret-left absolute text-gray-500"},null,-1),U={key:1,class:"text-right break-all mb-8"},V={class:"mr-2 text-gray-400 text-xs"},q={key:0,class:"\n                  inline-block\n                  relative\n                  bg-blue-900\n                  text-white text-lg\n                  px-3\n                  py-1\n                  mb-2\n                  rounded-lg\n                "},F=i("i",{class:"fas fa-2x fa-caret-right absolute text-blue-900"},null,-1),K={class:"text-sm text-red-500 mb-2"},W={class:"fas fa-exclamation-triangle"},z={class:"flex justify-end"},A={key:2,class:"text-center mb-6"},B={class:"bg-gray-400 px-2 py-1 text-sm text-gray-100 rounded-lg"},E={class:"\n          flex\n          justify-center\n          max-w-[500px]\n          w-full\n          bg-gray-800\n          dark:bg-gray-300\n          dark:shadow-lg\n          p-5\n          rounded-b-lg\n        "},G=i("i",{class:"far fa-paper-plane text-xl"},null,-1);f.render=function(e,t,a,n,l,b){return s(),r("div",k,[i("div",{class:"\n        w-[180px]\n        mt-3\n        bg-gray-700\n        dark:bg-white\n        dark:shadow-md\n        rounded-lg\n        hidden\n        md:block\n      ",style:{height:n.height-100+"px"}},[i("p",w," 線上人數："+o(n.onLine.length),1),i("ul",j,[(s(!0),r(c,null,d(n.onLine,(e=>(s(),r("li",{class:"flex items-center mb-2 text-white dark:text-gray-600",key:e},[i("img",{class:"w-[30px] h-[40px] mr-1",src:Object.values(e).join(""),alt:""},null,8,["src"]),x(" "+o(Object.keys(e).join(""))+" ",1),O])))),128))])],4),i("div",D,[i("div",{ref:"scroll",class:["\n          w-full\n          sm:w-[500px]\n          max-h-[750px]\n          scroll\n          overflow-y-auto overflow-x-hidden\n          bg-gray-700\n          dark:bg-white\n          rounded-t-lg\n          p-4\n        ",n.checked?["scroll-track","scroll-thumb"]:"scroll"],style:{height:n.height-180+"px"}},[i("div",I,[i("p",L," 線上人數："+o(n.onLine.length),1)]),i("ul",M,[(s(!0),r(c,null,d(n.data,(e=>(s(),r(c,{key:e[0]},[n.tempId.indexOf(e[0])<0&&""!==Object.values(e[1])[0].content?(s(),r("li",C,[i("img",{class:"w-[40px] h-[50px]",src:Object.values(e[1])[0].img,alt:"avatar"},null,8,["src"]),i("div",S,[i("div",T,[x(o(Object.keys(e[1]).join(""))+" ",1),i("span",H,o(new Date(Object.values(e[1])[0].date).toLocaleString())+o(Object.values(e[1])[0].edit?"(已編輯)":""),1)]),i("div",J,[N,x(" "+o(Object.values(e[1])[0].content),1)])])])):n.tempId.indexOf(e[0])>=0&&""!==Object.values(e[1])[0].content?(s(),r("li",U,[i("span",V,o(new Date(Object.values(e[1])[0].date).toLocaleString())+o(Object.values(e[1])[0].edit?"(已編輯)":""),1),n.editInput!==e[0]?(s(),r("div",q,[F,x(" "+o(Object.values(e[1])[0].content),1)])):u((s(),r("input",{key:1,type:"text",class:"\n                  mb-2\n                  py-1\n                  pl-2\n                  rounded-lg\n                  dark:border-2 dark:border-gray-500\n                ","onUpdate:modelValue":t[1]||(t[1]=e=>n.editMessage=e)},null,512)),[[g,n.editMessage]]),u(i("div",K,[u(i("i",W,null,512),[[p,""===n.editMessage||n.editMessage===Object.values(e[1])[0].content]]),x(" "+o(n.editMessage===Object.values(e[1])[0].content?"尚未編輯新留言":""===n.editMessage?"編輯留言不可為空":""),1)],512),[[p,n.verify&&n.editInput===e[0]]]),i("div",z,[i("button",{class:"\n                    bg-gray-500\n                    hover:bg-gray-800\n                    text-white text-sm\n                    flex\n                    rounded-lg\n                    px-2\n                    py-1\n                    mr-3\n                  ",onClick:t=>n.editData(e[0],Object.values(e[1])[0].content,!0)},o(n.editInput!==e[0]?"編輯":"取消"),9,["onClick"]),n.editInput!==e[0]?(s(),r("button",{key:0,class:"\n                    bg-gray-500\n                    hover:bg-gray-800\n                    text-white text-sm\n                    rounded-lg\n                    px-2\n                    py-1\n                  ",onClick:t=>n.removeMessage(e[0])}," 收回 ",8,["onClick"])):(s(),r("button",{key:1,class:"\n                    bg-green-600\n                    hover:bg-green-900\n                    text-white text-sm\n                    rounded-lg\n                    px-2\n                    py-1\n                  ",onClick:t=>n.editData(e[0],Object.values(e[1])[0].content,!1)}," 確認 ",8,["onClick"]))])])):(s(),r("li",A,[i("span",B,o(Object.keys(e[1]).join(""))+"已收回訊息",1)]))],64)))),128))])],6),i("div",E,[u(i("input",{type:"text",placeholder:n.str,"onUpdate:modelValue":t[2]||(t[2]=e=>n.message=e),onKeydown:t[3]||(t[3]=v((e=>n.addData()),["enter"])),class:"rounded-l-lg p-2 w-full"},null,40,["placeholder"]),[[g,n.message]]),i("button",{onClick:t[4]||(t[4]=(...e)=>n.addData&&n.addData(...e)),class:"\n            bg-gray-500\n            hover:bg-gray-700\n            text-white\n            rounded-r-lg\n            px-3\n            py-1\n          "},[G])])])])};export default f;
