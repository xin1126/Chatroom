import{n as e,i as o,d as a,v as l}from"./role.ecb8d499.js";import{e as u}from"./vendor.da7949e7.js";const v=u(""),n=u(""),t=u(""),s=u(""),c=u(""),i=u(""),r=u(!1),p=()=>{const e=setInterval((()=>{c.value=s.value.readyState,c.value&&clearInterval(e)}),500)},b=()=>{const l={},u={};l[e.value]=o.value,u[e.value]={content:"",status:!0},a.ref("chatroom").push().set(u).then((()=>{a.ref("onLine").push().set(l)})).then((()=>{s.value=new WebSocket("wss://fierce-savannah-16080.herokuapp.com/"),p()})),a.ref().on("value",(e=>{v.value=Object.entries(e.val().chatroom),e.val().onLine&&(n.value=Object.entries(e.val().onLine).map((e=>e[1]))||{})}))},m=(u,c)=>{let i;const b={},m={},h={};a.ref("publicRoom").push().set(1),a.ref("publicRoom").once("value",(o=>{t.value=Object.keys(o.val()).pop(),b[e.value]={content:"",status:!0},a.ref("publicRoom").child(t.value).push().set(b),c&&(h[t.value]=l.value,a.ref("privateRoom").push().set(h))})),a.ref("onLinePublicRoom").push().set(1),a.ref("onLinePublicRoom").once("value",(l=>{i=Object.keys(l.val()).pop(),m[e.value]=o.value,a.ref("onLinePublicRoom").child(i).push().set(m).then((()=>{s.value=new WebSocket(u),p()}))})),a.ref().on("value",(e=>{var o,a;void 0!==(null==(o=e.val())?void 0:o.publicRoom)&&r.value&&e.val().publicRoom[t.value]&&(v.value=Object.entries(e.val().publicRoom[t.value]),(null==(a=e.val().onLinePublicRoom)?void 0:a[i])&&(n.value=Object.entries(e.val().onLinePublicRoom[i]).map((e=>e[1]))))}))},h=()=>{let l,u;const t={},c={},b={};a.ref("publicRoom").once("value",(o=>{t[e.value]={content:"",status:!0},a.ref("publicRoom").child(i.value).push().set(t),l=Object.keys(o.val()).indexOf(i.value)})),a.ref("onLinePublicRoom").once("value",(v=>{u=Object.keys(v.val())[l],c[e.value]=o.value,a.ref("onLinePublicRoom").child(u).push().set(c),b[i.value]=u,a.ref("targetRoom").push().set(b).then((()=>{s.value=new WebSocket("wss://young-coast-22846.herokuapp.com/"),p()}))})),a.ref().on("value",(e=>{var o,a;void 0!==(null==(o=e.val())?void 0:o.publicRoom)&&r.value&&e.val().publicRoom[i.value]&&(v.value=Object.entries(e.val().publicRoom[i.value]),(null==(a=e.val().onLinePublicRoom)?void 0:a[u])&&(n.value=Object.entries(e.val().onLinePublicRoom[u]).map((e=>e[1]))||{}))}))};export{h as a,m as b,s as c,v as d,t as e,r as f,b as g,n as o,i as r,c as w};
